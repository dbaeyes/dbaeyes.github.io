<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="在遙遠的地方 一切虔誠終必相遇">

    <title>DBMS_JOB包的用法 (zt) - Microdust</title>

    <link rel="canonical" href="http://dbaeyes.github.io/oracle/usage-of-a-dbms-job-package-zt.html">

    <!-- Icons -->
  <link rel="shortcut icon" href="img/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Microdust</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/About.html">About</a>
                </li>
                
                <li>
                    <a href="/Lists.html">Reading</a>
                </li>
                
                <li>
                    <a href="/Tools.html">Tools</a>
                </li>
                
                <li>
                    <a href="/tags.html">Tags</a>
                </li>
                
                <li>
                    <a href="/photos/Instagram/">Photos: Instagram</a>
                </li>
                
                <li>
                    <a href="/photos/">Photos</a>
                </li>
                

            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/fantasy.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="Tags">
                        
                        <a class="tag" href="/Tags/#job" title="job">job</a>
                        
                        <a class="tag" href="/Tags/#oracle" title="oracle">oracle</a>
                        
                    </div>
                    <h1>DBMS_JOB包的用法 (zt)</h1>
                    
                    <span class="meta">Posted by {"login"=>"Toby", "email"=>"renwei.chu@gmail.com", "display_name"=>"David", "first_name"=>"", "last_name"=>""} on November 6, 2008</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">

                <p>--20080821_非常男女系统每月第一天给用户赠送玫瑰花的job_062976--<br />
[cc lang="sql"]<br />
DECLARE<br />
n_job_number number;<br />
begin<br />
    DBMS_JOB.SUBMIT(n_job_number<br />
                   ,'PRO_FCNN_USER_JOB;'<br />
                   ,TRUNC(ADD_MONTHS(sysdate, 1), 'MM') + 4/24     --每月1号的凌晨4点执行--<br />
                   ,'ADD_MONTHS(sysdate, 1)');    --下次执行的时间是下个月的1号--<br />
    commit;<br />
end;<br />
[/cc]<br />
例如：<br />
间隔trunc(sysdate)+1+14/24 就是每天下午2点执行一次proc_yw存储过程；</p>
<p>如间隔trunc(sysdate)+1+33/48就是每天下午4:30时执行一次</p>
<p>每天 8/9/10/15/16/17/23   7个整点执行的报告<br />
job   interval </p>
<p>trunc(sysdate) +   decode(to_char(sysdate,'hh24'),8,9,9,10,10,15,15,16,16,17,17,23,32)/24</p>
<p>一个简单例子：<br />
1、创建测试表<br />
SQL> create table a(a date);</p>
<p>表已创建。</p>
<p>2、创建一个自定义过程<br />
[cc lang="sql"]<br />
SQL> create or replace procedure test as<br />
2 begin<br />
3 insert into a values(sysdate);<br />
4 end;<br />
5 /</p>
<p>过程已创建。</p>
<p>3、创建JOB<br />
SQL> variable job1 number;<br />
SQL><br />
SQL> begin<br />
2 dbms_job.submit(:job1,'test;',sysdate,'sysdate+1/1440');　　--每天1440分钟，即一分钟运行test过程一次<br />
3 COMMIT;<br />
4 end;<br />
5 /</p>
<p>PL/SQL 过程已成功完成。</p>
<p>4、运行JOB<br />
SQL> begin<br />
2 dbms_job.run(:job1);<br />
3 end;<br />
4 /</p>
<p>PL/SQL 过程已成功完成。</p>
<p>SQL> select to_char(a,'yyyy/mm/dd hh24:mi:ss') 时间 from a;</p>
<p>时间<br />
-------------------<br />
2001/01/07 23:51:21<br />
2001/01/07 23:52:22<br />
2001/01/07 23:53:24</p>
<p>5、修改下次执行时间（10分钟后执行）<br />
SQL>begin<br />
2 dbms_job.next_date (:job1,SYSDATE + 10/(24*60));<br />
3 end;<br />
4 /</p>
<p>6、删除JOB<br />
SQL> begin<br />
2 dbms_job.remove(:job1);<br />
3 end;<br />
4 /</p>
<p>PL/SQL 过程已成功完成。<br />
[/cc]<br />
*************************************************</p>
<p>DBMS_Job包含以下子过程：<br />
Broken()过程。<br />
change()过程。<br />
Interval()过程。<br />
Isubmit()过程。<br />
Next_Date()过程。<br />
Remove()过程。<br />
Run()过程。<br />
Submit()过程。<br />
User_Export()过程。<br />
What()过程。</p>
<p>1、Broken()过程更新一个已提交的工作的状态，典型地是用来把一个已破工作标记为未破工作。这个过程有三个参数：job 、broken与next_date。<br />
PROCEDURE Broken (<br />
job IN binary_integer,<br />
Broken IN boolean,<br />
next_date IN date :=SYSDATE<br />
)</p>
<p>job参数是工作号，它在问题中唯一标识工作。<br />
broken参数指示此工作是否将标记为破——TRUE说明此工作将标记为破，而FLASE说明此工作将标记为未破。<br />
next_date参数指示在什么时候此工作将再次运行。此参数缺省值为当前日期和时间。</p>
<p>2、Change()过程用来改变指定工作的设置。<br />
这个过程有四个参数：job、what 、next_date与interval。<br />
PROCEDURE Change (<br />
job IN binary_integer,<br />
What IN varchar2,<br />
next_date IN date,<br />
interval IN varchar2)</p>
<p>此job参数是一个整数值，它唯一标识此工作。<br />
What参数是由此工作运行的一块PL/SQL代码块。<br />
next_date参数指示何时此工作将被执行。<br />
interval参数指示一个工作重执行的频度。</p>
<p>3、Interval()过程用来显式地设置重执行一个工作之间的时间间隔数。<br />
这个过程有两个参数：job与interval。<br />
PROCEDURE Interval (<br />
job IN binary_integer,<br />
Interval IN varchar2)</p>
<p>job参数标识一个特定的工作。<br />
interval参数指示一个工作重执行的频度。</p>
<p>4、ISubmit()过程用来用特定的工作号提交一个工作。<br />
这个过程有五个参数：job、what、next_date、interval与no_parse。<br />
PROCEDURE ISubmit (<br />
job IN binary_ineger,<br />
What IN varchar2,<br />
next_date IN date,<br />
interval IN varchar2,<br />
no_parse IN booean:=FALSE)<br />
这个过程与Submit()过程的唯一区别在于此job参数作为IN型参数传递且包括一个由开发者提供的工作号。如果提供的工作号已被使用，将产生一个错误。</p>
<p>5、Next_Date()过程用来显式地设定一个工作的执行时间。这个过程接收两个参数：job与next_date。<br />
PROCEDURE Next_Date(<br />
job IN binary_ineger,<br />
next_date IN date)</p>
<p>job标识一个已存在的工作。<br />
next_date参数指示了此工作应被执行的日期与时间。</p>
<p>6、Remove()过程来删除一个已计划运行的工作。这个过程接收一个参数：<br />
PROCEDURE Remove(job IN binary_ineger);</p>
<p>job参数唯一地标识一个工作。这个参数的值是由为此工作调用Submit()过程返回的job参数的值。已正在运行的工作不能由调用过程序删除。</p>
<p>7、Run()过程用来立即执行一个指定的工作。这个过程只接收一个参数：<br />
PROCEDURE Run(job IN binary_ineger) </p>
<p>job参数标识将被立即执行的工作。</p>
<p>8、使用Submit()过程，工作被正常地计划好。<br />
这个过程有五个参数：job、what、next_date、interval与no_parse。<br />
PROCEDURE Submit (<br />
job OUT binary_ineger,<br />
What IN varchar2,<br />
next_date IN date,<br />
interval IN varchar2,<br />
no_parse IN booean:=FALSE)</p>
<p>job参数是由Submit()过程返回的binary_ineger。用来唯一标识一个工作。<br />
what参数是将被执行的PL/SQL代码块。<br />
next_date参数指识何时将运行这个工作。<br />
interval参数何时这个工作将被重执行。<br />
dbms_job.submit(:job1,'test;',sysdate,'sysdate+1/1440');　　<br />
sysdate+1/1440:每天1440分钟，即一分钟运行test过程一次<br />
TRUNC(SYSDATE+1)+10/24:每天上午10点执行一次<br />
no_parse参数指示此工作在提交时或执行时是否应进行语法分析——TRUE<br />
指示此PL/SQL代码在它第一次执行时应进行语法分析，<br />
而FALSE指示本PL/SQL代码应立即进行语法分析。</p>
<p>9、User_Export()过程返回一个命令，此命令用来安排一个存在的工作以便此工作能重新提交。此程序有两个参数：job与my_call。<br />
PROCEDURE User_Export(<br />
job IN binary_ineger,<br />
my_call IN OUT varchar2)</p>
<p>job参数标识一个安排了的工作。<br />
my_call参数包含在它的当前状态重新提交此工作所需要的正文。</p>
<p>10、What()过程应许在工作执行时重新设置此正在运行的命令。这个过程接收两个参数：job与what。</p>
<p>PROCEDURE What (<br />
job IN binary_ineger,<br />
What IN OUT varchar2)</p>
<p>job参数标识一个存在的工作。<br />
what参数指示将被执行的新的PL/SQL代码。</p>
<p>-- FROM :http://java-admin.javaeye.com/blog/250363</p>


                <hr>


                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC A-S 4.0 International License</a>.

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/oracle/global-temporary-table-zt.html" data-toggle="tooltip" data-placement="top" title="GLOBAL TEMPORARY TABLE (zt)">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/os/unix-ftp-command-xiangjie.html" data-toggle="tooltip" data-placement="top" title="Unix FTP命令详解">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Duoshuo Share start -->
                <style>
                    .ds-share{
                        text-align: right;
                    }
                    
                    @media only screen and (max-width: 700px) {
                        .ds-share {

                        }
                    }
                </style>

                <div class="ds-share"
                    data-thread-key="/oracle/usage-of-a-dbms-job-package-zt" data-title="DBMS_JOB包的用法 (zt)"
                    data-images="http://dbaeyes.github.io/img/fantasy.jpg"
                    data-content="--20080821_非常男女系统每月第一天给用户赠送玫瑰花的job_062976--
[cc lang="sql"]
DECLARE
n_job_num... | Microdust:Azeril's blog"
                    data-url="http://dbaeyes.github.io/oracle/usage-of-a-dbms-job-package-zt.html">
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">

                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- Duoshuo Share end-->




                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread" data-thread-key="/oracle/usage-of-a-dbms-job-package-zt" data-title="DBMS_JOB包的用法 (zt)" data-url="http://dbaeyes.github.io/oracle/usage-of-a-dbms-job-package-zt.html"></div>
                </div>
                <!-- 多说评论框 end -->
            </div>
        </div>
    </div>
</article>



<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"azeril"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->



</script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

  
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- kill the Facebook and Weibo -->
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://twitter.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://github.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <!--
                    
                    <li>
                        <a href="http://www.douban.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-douban fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    <!--
                    
                    <li>
                        <a href="https://www.facebook.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    

                    <!--
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                </ul>
                <p class="copyright text-muted">
                &copy; 2011~2016 David ♪ Powered by Jekyll.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>




<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js",function(){
        hljs.initHighlightingOnLoad();
    })
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


</body>

</html>