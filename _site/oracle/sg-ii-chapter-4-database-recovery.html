<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="在遙遠的地方 一切虔誠終必相遇">

    <title>SG II: Chapter 4 | Database Recovery - Microdust</title>

    <link rel="canonical" href="http://dbaeyes.github.io/oracle/sg-ii-chapter-4-database-recovery.html">

    <!-- Icons -->
  <link rel="shortcut icon" href="img/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Microdust</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/About.html">About</a>
                </li>
                
                <li>
                    <a href="/Lists.html">Reading</a>
                </li>
                
                <li>
                    <a href="/Tools.html">Tools</a>
                </li>
                
                <li>
                    <a href="/tags.html">Tags</a>
                </li>
                
                <li>
                    <a href="/photos/Instagram/">Photos: Instagram</a>
                </li>
                
                <li>
                    <a href="/photos/">Photos</a>
                </li>
                

            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/fantasy.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="Tags">
                        
                        <a class="tag" href="/Tags/#oracle" title="oracle">oracle</a>
                        
                        <a class="tag" href="/Tags/#study" title="study">study</a>
                        
                    </div>
                    <h1>SG II: Chapter 4 | Database Recovery</h1>
                    
                    <span class="meta">Posted by {"login"=>"Toby", "email"=>"renwei.chu@gmail.com", "display_name"=>"David", "first_name"=>"", "last_name"=>""} on April 23, 2008</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">

                <p><strong><span style="color: #ff6600;">Objects:</span></strong></p>
<div>
<p><span style="color: #0000ff;">Recover the control file.<br />
Explain reasons for incomplete recovery.<br />
Perform incomplete recovery using EM.<br />
Perform incomplete recovery using RMAN.<br />
Perform incomplete recovery using SQL.<br />
Perform database recovery following a RESETLOGS operation.</span></p>
<p>-------------------------------</p>
<p><strong><span style="color: #ff6600;">Server-Managed Recovery</span></strong></p>
<p>SQL&gt; startup mount</p>
<p>Next, run the RESTORE DATABASE and RECOVER DATABASE commands:</p>
<p><span>$ rman target /</span></p>
<p><span>RMAN&gt; run<br />
2&gt; {<br />
3&gt; allocate channel c1 type disk;<br />
4&gt; restore database;<br />
5&gt; recover database;<br />
6&gt; alter database open;<br />
7&gt; }</span></p>
<p><span>using target database control file instead of recovery catalog<br />
allocated channel: c1<br />
channel c1: sid=155 devtype=DISK</span></p>
<p><span><strong>Starting restore</strong> at 23-APR-08</span></p>
<p><span>channel c1: starting datafile backupset restore<br />
channel c1: specifying datafile(s) to restore from backup set<br />
restoring datafile 00001 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_system_3zkmhwp7_.dbf<br />
restoring datafile 00002 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_undotbs1_3zkmhwwq_.dbf<br />
restoring datafile 00003 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_sysaux_3zkmhwpk_.dbf<br />
restoring datafile 00004 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_users_3zkmhwy6_.dbf<br />
restoring datafile 00005 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_db_test_3zpvo97g_.dbf<br />
restoring datafile 00006 to /u01/app/oracle/oradata/ORCL/datafile/o1_mf_data_406p21qh_.dbf<br />
channel c1: reading from backup piece /u01/app/oracle/flash_recovery_area/ORCL/backupset/2008_04_15/o1_mf_nnndf_TAG20080415T225737_409jm1s1_.bkp<br />
channel c1: restored backup piece 1<br />
piece handle=/u01/app/oracle/flash_recovery_area/ORCL/backupset/2008_04_15/o1_mf_nnndf_TAG20080415T225737_409jm1s1_.bkp tag=TAG20080415T225737<br />
channel c1: restore complete, elapsed time: 00:00:46<br />
<strong>Finished restore</strong> at 23-APR-08</span></p>
<p><span><strong>Starting recover</strong> at 23-APR-08</span></p>
<p><span><strong>starting media recovery</strong><br />
media recovery complete, elapsed time: 00:00:26</span></p>
<p><span><strong>Finished recover</strong> at 23-APR-08</span></p>
<p><span>database opened<br />
released channel: c1</span></p>
<p><span>RMAN&gt;</span></p>
<p>--------------------------------------</p>
<p><strong><span style="color: #ff6600;">User-Managed Recovery</span></strong></p>
<p>User-managed recovery is the traditional recovery method where you directly manage the database files required to recover the database.</p>
<p>The basic procedure to perform user-managed recovery consists of first identifying the database<br />
files that need to be restored.<br />
Next, the database must be placed in the appropriate mode, either mounted or opened.<br />
Then the database files are restored from tape or disk to the appropriate location. Finally, the database can be recovered using the RECOVER command to apply archived redo logs to the database files if necessary. -- <em>SQL&gt; recover database;</em></p>
<p>---------------------------------------</p>
<p><strong><span style="color: #ff6600;">Recovering Control Files</span></strong></p>
<p><strong><span style="color: #0000ff;">Recovering a Control File Autobackup</span></strong><br />
<span><strong>RMAN&gt; configure controlfile autobackup on;</strong></span></p>
<p>Perform a backup with the control file autobackup enabled:<br />
RMAN&gt; run<br />
2&gt; {<br />
3&gt; backup database;<br />
4&gt; backup (archivelog all);<br />
5&gt; }</p>
<p>connected to target database (not started)<br />
<strong>RMAN&gt; set dbid 2615281366;</strong></p>
<p><strong>RMAN&gt; restore controlfile from autobackup;</strong></p>
<p>RMAN&gt; alter database mount;</p>
<p>RMAN&gt; <strong>recover database;</strong></p>
<p>RMAN&gt; alter database open <strong>resetlogs</strong>;</p>
<p><strong><span style="color: #ff6600;">Re-creating a Control File</span></strong></p>
<p><span>SQL&gt; alter database backup controlfile to trace;</span></p>
<p>The first is Set #1 NORESETLOGS case, and the second is Set #2 RESETLOGS case. The RESETLOGS case is used for incomplete recovery, and NORESETLOGS is used for complete recovery options</p>
<p>[oracle@localhost udump]$ more orcl_ora_3486.trc</p>
<p>Next, copy out the appropriate case needed to run. In this case, use the NORESETLOGS case, because you are recovering the database up to the point of failure.</p>
<p>SQL&gt; @backup_controlfile_noreset.txt --create control file</p>
<p>------------------------------</p>
<p><strong><span style="color: #ff6600; font-size: medium;">Performing an Incomplete Recovery</span></strong></p>
<p>With incomplete recovery, after the recovery process has ended, the database is still missing <strong>transactions</strong> that were in the database before the failure.<br />
Incomplete recovery is sometimes called <strong>database point-in-time recovery</strong> (<strong>DBPITR</strong>) because this recovery is to a determined point-in-time.</p>
<p><strong><span style="color: #0000ff;">Incomplete Recovery Types and Uses</span></strong></p>
<p><strong>UNTIL TIME (RMAN/User-managed)</strong> Stop recovery before a known time that introduces corruption in the database or some undesired event in the database that cannot be rolled back.</p>
<p><strong>UNTIL SEQUENCE(RMAN)</strong> Stop before a known redo log sequence that introduces corruption or some undesired event in the database that cannot be rolled back.</p>
<p><strong>UNTIL SCN (RMAN)/UNTIL CHANGE (User-managed)</strong> Stop before a known SCN that introduces corruption or some undesired event in the database that cannot be rolled back. The SCN can be a more finite stopping point than a time or redo log sequence because it is by transaction.</p>
<p><strong>UNTIL CANCEL (User-managed)</strong> Stop when administrator issues the CANCEL command. This is good for making a test database from backup, where the transactional stopping point is not important to the validity of the database.</p>
<p><strong><span style="color: #0000ff;">RMAN Incomplete Recovery</span></strong></p>
<p><span style="color: #3366ff;">-----------------------------rman until time ---------------------</span><br />
SQL&gt; startup mount</p>
<p>c:\&gt;set NLS_DATE_FORMAT=DD-MON-YYYY HH24:MI:SS</p>
<p>RMAN&gt; run<br />
2&gt; {<br />
3&gt; set<strong> until time</strong> '06-SEP-2004 11:25:00';<br />
4&gt; restore database;<br />
5&gt; recover database;<br />
6&gt; }</p>
<p>RMAN&gt; alter database open <strong>resetlogs</strong>;</p>
<p><span style="color: #3366ff;">--------------------------rman until sequence--------------</span></p>
<p>SQL&gt; select * from v$log_history;</p>
<p>SQL&gt; startup mount</p>
<p>RMAN&gt; run<br />
2&gt; {<br />
3&gt; set <strong>until sequence 3</strong> thread 1;<br />
4&gt; restore database;<br />
5&gt; recover database;<br />
6&gt; }</p>
<p>RMAN&gt; alter database open resetlogs;</p>
<p><span style="color: #3366ff;">----------------------User-Managed until time ---------------------</span></p>
<p>SQL&gt; startup mount</p>
<p>SQL&gt; recover database until time '06-SEP-2004 15:15:00';</p>
<p>SQL&gt; alter database open resetlogs;</p>
<p><span style="color: #3366ff;">----------------------User-Managed cancel-based---------------------</span></p>
<p>Using the ALTER DATABASE BACKUP CONTROLFILE TO TRACE command.<br />
Moving a database or create a test database.</p>
<p>&gt;copy C:\oracle\backup\ora101t\*.DBF .</p>
<p>View the backup control file to verify</p>
<p>SQL&gt; connect / as sysdba;<br />
Connected to an idle instance.<br />
SQL&gt; @backup_control_reset.txt</p>
<p>SQL&gt; recover database <strong>until cancel using backup controlfile</strong>;</p>
<p>SQL&gt; alter database open resetlogs;</p>
<p>------------------------------------------------------</p>
<p>Database Recovery Using Enterprise Manager</p>
<p>------------------------------------------------------</p>
<p><strong><span style="color: #ff6600;">Performing a Recovery after a RESETLOGS Operation</span></strong></p>
<p>The RESETLOGS clause is required in most incomplete recovery situations to open the database.</p>
</div>


                <hr>


                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC A-S 4.0 International License</a>.

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/os/cent-of-solaris-knowledge-solution-20-problem.html" data-toggle="tooltip" data-placement="top" title="20%的SOLARIS知识解决80%的问题">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/oracle/sg-ii-chapter-5-understanding-the-flashback-database.html" data-toggle="tooltip" data-placement="top" title="SG II: Chapter 5 | Understanding the Flashback Database">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Duoshuo Share start -->
                <style>
                    .ds-share{
                        text-align: right;
                    }
                    
                    @media only screen and (max-width: 700px) {
                        .ds-share {

                        }
                    }
                </style>

                <div class="ds-share"
                    data-thread-key="/oracle/sg-ii-chapter-4-database-recovery" data-title="SG II: Chapter 4 | Database Recovery"
                    data-images="http://dbaeyes.github.io/img/fantasy.jpg"
                    data-content="Objects:

Recover the control file.
Explain reasons for incomplete recovery.
... | Microdust:Azeril's blog"
                    data-url="http://dbaeyes.github.io/oracle/sg-ii-chapter-4-database-recovery.html">
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">

                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- Duoshuo Share end-->




                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread" data-thread-key="/oracle/sg-ii-chapter-4-database-recovery" data-title="SG II: Chapter 4 | Database Recovery" data-url="http://dbaeyes.github.io/oracle/sg-ii-chapter-4-database-recovery.html"></div>
                </div>
                <!-- 多说评论框 end -->
            </div>
        </div>
    </div>
</article>



<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"azeril"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->



</script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

  
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- kill the Facebook and Weibo -->
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://twitter.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://github.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <!--
                    
                    <li>
                        <a href="http://www.douban.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-douban fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    <!--
                    
                    <li>
                        <a href="https://www.facebook.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    

                    <!--
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                </ul>
                <p class="copyright text-muted">
                &copy; 2011~2016 David ♪ Powered by Jekyll.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>




<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js",function(){
        hljs.initHighlightingOnLoad();
    })
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


</body>

</html>