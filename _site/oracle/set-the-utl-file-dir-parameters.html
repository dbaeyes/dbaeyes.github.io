<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="在遙遠的地方 一切虔誠終必相遇">

    <title>设置UTL_FILE_DIR参数 - Microdust</title>

    <link rel="canonical" href="http://dbaeyes.github.io/oracle/set-the-utl-file-dir-parameters.html">

    <!-- Icons -->
  <link rel="shortcut icon" href="img/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Microdust</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/About.html">About</a>
                </li>
                
                <li>
                    <a href="/Lists.html">Reading</a>
                </li>
                
                <li>
                    <a href="/Tools.html">Tools</a>
                </li>
                
                <li>
                    <a href="/tags.html">Tags</a>
                </li>
                
                <li>
                    <a href="/photos/Instagram/">Photos: Instagram</a>
                </li>
                
                <li>
                    <a href="/photos/">Photos</a>
                </li>
                

            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/fantasy.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="Tags">
                        
                    </div>
                    <h1>设置UTL_FILE_DIR参数</h1>
                    
                    <span class="meta">Posted by {"login"=>"Toby", "email"=>"renwei.chu@gmail.com", "display_name"=>"David", "first_name"=>"", "last_name"=>""} on March 13, 2008</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 post-container">

                <p>第一步：以管理员用户登陆</p>
<div>
<p>   如：conn    sys/password@sid    as    sysdba</p>
<p>第二步：设置可操作目录<br />
需要指定utl_file包可以操作的目录。在oracle    10g以前，可以用以下方法：<br />
1、alter    system    set    utl_file_dir=<em>'</em>e:\utl<em>'</em>    scope=spfile;<br />
2、在init.ora文件中，配置如下：<br />
UTL_FILE=E:\utl或者UTL_FILE_DIR=E:\utl<br />
在oracle    10g中建议用以下方法配置：CREATE    DIRECTORY    utl    AS   <em>'</em>E:\utl<em>'</em>;<br />
参见oracle    online:<br />
In    the    past,    accessible    directories    for    the    UTL_FILE    functions     were    specified    in    the    initialization    file    using    the    UTL_FILE_DIR    parameter.    However,    UTL_FILE_DIR    access    is    not    recommended.    It    is    recommended    that    you    use    the    CREATE    DIRECTORY    feature,    which    replaces    UTL_FILE_DIR.    Directory    objects    offer    more    flexibility    and    granular    control    to    the    UTL_FILE    application    administrator,    can    be    maintained    dynamically    (that    is,    without    shutting    down    the    database),    and    are    consistent    with    other    Oracle    tools.    CREATE    DIRECTORY    privilege    is    granted    only    to    SYS    and    SYSTEM    by    default.</p>
<p>第三步：授权给指定用户，以便执行utl_file<br />
GRANT    EXECUTE    ON    utl_file    TO    scott;</p>
<p>第四步：conn    scott/tiger<br />
就可以正常使用utl_file了。</p>
<p>摘要：本文主要讨论如何利用Oracle的UTL_FILE包来实现对磁盘文件的I/O操作。</p>
<p>文件I/O对于数据库的开发来说显得很重要，比如如果数据库中的一部分数据来自于磁盘文件，<br />
那么就需要使用I/O接口把数据导入到数据库中来。在    PL/SQL中没有直接的I/O接口，<br />
一般在调试程序时可以使用Oracle自带的DBMS_OUTPUT包的put_line函数（即向屏幕进行I/O    操作）即可，<br />
但是对于磁盘文件的I/O操作它就无能为力了。其实Oracle同样也提供了可以进行文件I/O的实用包-----UTL_FILE包，<br />
利用这个实用包提供的函数来实现对磁盘的I/O操作。</p>
<p>1．    准备工作</p>
<p>由于Oracle数据库对包创建的目录有一个安全管理的问题，所以并不是所有的文件目录能够被UTL_FILE包所访问，<br />
要更新这种目录设置，就得到init.ora里将UTL_FILE_DIR域设置为*，这样UTL_FILE包就可以对所有的目录文件进行访问了。</p>
<p>2．    文件I/O的实施</p>
<p>UTL_FILE包提供了很多实用的函数来进行I/O操作，主要有以下几个函数：</p>
<p>fopen</p>
<p>打开指定的目录路径的文件。</p>
<p>get_line</p>
<p>获取指定文件的一行的文本。</p>
<p>put_line</p>
<p>向指定的文件写入一行文本。</p>
<p>fclose</p>
<p>关闭指定的文件。</p>
<p>下面利用这些函数，实现从文件取数据，然后将数据写入到相应的数据库中。</p>
<p>create    or    replace    procedure    loadfiledata(p_path    varchar2,p_filename    varchar2)    as<br />
v_filehandle    utl_file.file_type;    --定义一个文件句柄<br />
v_text    varchar2(100);    --存放文本<br />
v_name    test_loadfile.name%type;<br />
v_addr_jd    test_loadfile.addr_jd%type;<br />
v_region    test_loadfile.region%type;<br />
v_firstlocation    number;<br />
v_secondlocation    number;<br />
v_totalinserted    number;<br />
begin<br />
if    (p_path    is    null    or    p_filename    is    null)    then<br />
goto    to_end;<br />
end    if;<br />
v_totalinserted:=0;<br />
/*open    specified    file*/<br />
v_filehandle:=utl_file.fopen(p_path,p_filename,<em>'</em>r<em>'</em>);<br />
loop<br />
begin<br />
utl_file.get_line(v_filehandle,v_text);<br />
exception<br />
when    no_data_found    then<br />
exit;<br />
end<br />
v_firstlocation:=instr(v_text,<em>'</em>,<em>'</em>,1,1);<br />
v_secondlocation:=instr(v_text,<em>'</em>,<em>'</em>,1,2);<br />
v_name:=substr(v_text,1,v_firstlocation-1);<br />
v_addr_jd:=substr(v_text,v_firstlocation+1,v_secondlocation-v_firstlocation-1);<br />
v_region:=substr(v_text,v_secondlocation+1);<br />
/*插入数据库操作*/<br />
insert    into    test_loadfile<br />
<em>value</em>s    (v_name,v_addr_jd,v_region);<br />
commit;<br />
end    loop;<br />
&lt;&lt;to_end&gt;&gt;<br />
null;<br />
end    loadfiledata;</p>
<p>可以不用在init.ora中改的<br />
只要用管理员的权限登陆，执行：<br />
create    directory    UTL_FILE_TEST    as   <em>'</em>\*<em>'</em><br />
应该就可以了,不用新启动oracle的<br />
不过其他用户要使用此目录要授权的<br />
/</p>
<p>grant    create    any    directory    to    scott;<br />
grant    create    any    library    to    scott;<br />
create    or    replace    directory    utllobdir    as   <em>'</em>C:\ep<em>'</em>;</p>
<p>在initsid.ora文件中，加入或修改<br />
设置utl_file_dir的要点：<br />
1。    utl_file_dir=*      这表示你能操作任何目录，尽量不要用<br />
2。    utl_file_dir=d:\    这表示你能操作d:\目录下的文件，但你不能操作d:\目录下的子目录<br />
3。注意在设置<br />
utl_file_dir=路径时，如果路径是长路径名，例如c:\my    temp目录，则你必须加上<em>'</em><em>'</em>，例如：<br />
utl_file_dir=<em>'</em>c:\my    temp<em>'</em><br />
4。utl_file_dir可以是多个路径<br />
utl_file_dir=c:\,d:\,d:\temp,<em>'</em>c:\my    temp<em>'</em><br />
5。设置完必须重新启动数据库</p>
<p>来源:http://unix-cd.com/unixcd12/article_6287.html</p>
</div>


                <hr>


                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC A-S 4.0 International License</a>.

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/oracle/hehe-continue.html" data-toggle="tooltip" data-placement="top" title="呵呵 继续++">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/web&amp;rt/harvard-library-study-room-on-the-walls-saying-harvard-library-study-room-wall-vtc-statement.html" data-toggle="tooltip" data-placement="top" title="哈佛图书馆自习室墙上的训言 Harvard Library study room wall VTC statement">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Duoshuo Share start -->
                <style>
                    .ds-share{
                        text-align: right;
                    }
                    
                    @media only screen and (max-width: 700px) {
                        .ds-share {

                        }
                    }
                </style>

                <div class="ds-share"
                    data-thread-key="/oracle/set-the-utl-file-dir-parameters" data-title="设置UTL_FILE_DIR参数"
                    data-images="http://dbaeyes.github.io/img/fantasy.jpg"
                    data-content="第一步：以管理员用户登陆

   如：conn    sys/password@sid    as    sysdba
第二步：设置可操作目录
需要指定u... | Microdust:Azeril's blog"
                    data-url="http://dbaeyes.github.io/oracle/set-the-utl-file-dir-parameters.html">
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">

                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- Duoshuo Share end-->




                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread" data-thread-key="/oracle/set-the-utl-file-dir-parameters" data-title="设置UTL_FILE_DIR参数" data-url="http://dbaeyes.github.io/oracle/set-the-utl-file-dir-parameters.html"></div>
                </div>
                <!-- 多说评论框 end -->
            </div>
        </div>
    </div>
</article>



<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"azeril"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->



</script>

<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>

  
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <!-- kill the Facebook and Weibo -->
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://twitter.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    

                    
                    <li>
                        <a href="https://github.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <!--
                    
                    <li>
                        <a href="http://www.douban.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-douban fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    <!--
                    
                    <li>
                        <a href="https://www.facebook.com/Azeril_Lapland">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    

                    <!--
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/Azeril">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    -->

                </ul>
                <p class="copyright text-muted">
                &copy; 2011~2016 David ♪ Powered by Jekyll.
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>




<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js",function(){
        hljs.initHighlightingOnLoad();
    })
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">


</body>

</html>